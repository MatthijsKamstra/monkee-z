{
"version":3,
"file":"monkee_load_inner.js",
"sourceRoot":"file:///",
"sources":["/Users/matthijskamstra/Documents/GIT/monkee-z/src/MonkeeLoadInner.hx","/usr/local/lib/haxe/std/haxe/iterators/ArrayIterator.hx","/Users/matthijskamstra/Documents/GIT/monkee-z/src/utils/Html.hx","/Users/matthijskamstra/Documents/GIT/monkee-z/src/utils/Time.hx"],
"sourcesContent":["package;\n\nimport utils.Html;\nimport js.html.InputElement;\nimport haxe.Json;\nimport utils.Time;\nimport js.html.Element;\nimport js.Browser.*;\nimport js.html.XMLHttpRequest;\nimport AST.LoadObj;\n\nclass MonkeeLoadInner {\n\tvar DEBUG = false;\n\n\tvar req = new XMLHttpRequest();\n\tvar dataAtr = \"data-load-inner\";\n\tvar loadingArr:Array<LoadObj> = [];\n\tvar loadingId = 0;\n\tvar timer:Time;\n\n\t// modern solution\n\t// https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch\n\n\tpublic function new() {\n\t\tdocument.addEventListener('DOMContentLoaded', (event) -> {\n\t\t\tif (DEBUG)\n\t\t\t\tconsole.info(App.callIn('MonkeeLoadInner'));\n\t\t\tinit();\n\t\t});\n\t}\n\n\tfunction init() {\n\t\tvar arr = document.querySelectorAll('[${dataAtr}]');\n\t\tfor (i in 0...arr.length) {\n\t\t\tvar wrapper:Element = cast arr[i];\n\t\t\tvar url = wrapper.getAttribute(dataAtr);\n\t\t\tvar target = wrapper.getAttribute('data-target');\n\t\t\tvar nameArr:Array<Element> = cast wrapper.querySelectorAll('[data-name]');\n\t\t\tif (DEBUG) {\n\t\t\t\ttrace(target);\n\t\t\t\ttrace(nameArr);\n\t\t\t}\n\t\t\t// if(DEBUG)console.log('templates url: ' + url);\n\t\t\tloadingArr.push({\n\t\t\t\tel: wrapper,\n\t\t\t\turl: url,\n\t\t\t\ttarget: target,\n\t\t\t\tnames: nameArr,\n\t\t\t});\n\t\t}\n\t\ttimer = new Time();\n\t\ttimer.start();\n\t\tif (DEBUG)\n\t\t\tconsole.group('Monkee Loader Inner');\n\t\tstartLoading(loadingId);\n\t}\n\n\tfunction startLoading(nr:Int) {\n\t\tif (nr >= loadingArr.length) {\n\t\t\tif (DEBUG)\n\t\t\t\tconsole.groupEnd();\n\t\t\treturn;\n\t\t}\n\t\tvar obj = loadingArr[nr];\n\t\tif (DEBUG) {\n\t\t\tconsole.log('start loading: ' + obj.url + ' into element');\n\t\t\tconsole.log(obj);\n\t\t}\n\t\tloadData(obj);\n\t\tloadingId++;\n\t}\n\n\tfunction loadData(obj:LoadObj) {\n\t\treq.open('GET', obj.url);\n\t\treq.onload = function() {\n\t\t\t// if(DEBUG)trace(req.response);\n\t\t\tvar body = Html.getBody(req.response);\n\t\t\t// if(DEBUG)trace(body);\n\t\t\tif (body == \"\")\n\t\t\t\tbody = req.response;\n\t\t\t// if(DEBUG)trace(body);\n\n\t\t\tif (obj.url.indexOf('json') != -1) {\n\t\t\t\tif (DEBUG)\n\t\t\t\t\tconsole.warn(obj.url);\n\t\t\t\tjsonConvert(obj, req.response);\n\t\t\t} else {\n\t\t\t\t// inject code\n\t\t\t\tif (obj.names.length > 0) {\n\t\t\t\t\tfor (i in 0...obj.names.length) {\n\t\t\t\t\t\tvar el = obj.names[i];\n\t\t\t\t\t\tHtml.processHTML(el, body, true);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tHtml.processHTML(obj.el, body, true);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (DEBUG) {\n\t\t\t\tconsole.log('- end loading and parsing url: ' + obj.url + ' into element');\n\t\t\t\tconsole.log(timer.total());\n\t\t\t}\n\n\t\t\t// load the next\n\t\t\tstartLoading(loadingId);\n\t\t};\n\n\t\treq.onerror = function(error) {\n\t\t\tif (DEBUG)\n\t\t\t\tconsole.error('[JS] error: $error');\n\t\t};\n\n\t\treq.send();\n\t}\n\n\tfunction jsonConvert(obj:LoadObj, str:String) {\n\t\tvar json = Json.parse(str);\n\n\t\tif (DEBUG) {\n\t\t\t// console.warn(json);\n\t\t\t// trace(json.firstname);\n\t\t\t// trace(Reflect.getProperty(json, 'firstname'));\n\n\t\t\ttrace(untyped json['lastname']);\n\t\t}\n\t\tif (obj.names.length > 0) {\n\t\t\tfor (i in 0...obj.names.length) {\n\t\t\t\tvar input:InputElement = cast obj.names[i];\n\t\t\t\t// input.value = Reflect.getProperty(json, input.getAttribute('data-name'));\n\t\t\t\tinput.value = untyped json[input.getAttribute('data-name')];\n\t\t\t}\n\t\t} else {\n\t\t\tHtml.processHTML(obj.el, str, true);\n\t\t}\n\t}\n\n\tstatic public function main() {\n\t\tvar app = new MonkeeLoadInner();\n\t}\n}\n","/*\n * Copyright (C)2005-2018 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n\npackage haxe.iterators;\n\n/**\n\tThis iterator is used only when `Array<T>` is passed to `Iterable<T>`\n**/\nclass ArrayIterator<T> {\n\tfinal array:Array<T>;\n\tvar current:Int = 0;\n\n\t/**\n\t\tCreate a new `ArrayIterator`.\n\t**/\n\t#if !hl inline #end\n\tpublic function new(array:Array<T>) {\n\t\tthis.array = array;\n\t}\n\n\t/**\n\t\tSee `Iterator.hasNext`\n\t**/\n\t#if !hl inline #end\n\tpublic function hasNext() {\n\t\treturn current < array.length;\n\t}\n\n\t/**\n\t\tSee `Iterator.next`\n\t**/\n\t#if !hl inline #end\n\tpublic function next() {\n\t\treturn array[current++];\n\t}\n}\n","package utils;\n\nimport js.html.Element;\nimport js.Browser.*;\nimport js.html.XMLHttpRequest;\n\nclass Html {\n\tpublic function new() {\n\t\t// your code\n\t}\n\n\t/**\n\t * extract the body (from documents that have a body)\n\t *\n\t * @param html\n\t */\n\tpublic static function getBody(html) {\n\t\tvar test:String = html.toLowerCase(); // to eliminate case sensitivity\n\t\tvar x:Int = test.indexOf(\"<body\");\n\t\tif (x == -1)\n\t\t\treturn \"\";\n\n\t\tx = test.indexOf(\">\", x);\n\t\tif (x == -1)\n\t\t\treturn \"\";\n\t\tvar y = test.lastIndexOf(\"</body>\");\n\t\tif (y == -1)\n\t\t\ty = test.lastIndexOf(\"</html>\");\n\t\tif (y == -1)\n\t\t\ty = html.length; // If no HTML then just grab everything till end\n\t\treturn html.slice(x + 1, y);\n\t}\n\n\t/**\n\t * [Description]\n\t * @param target\n\t * @param html\n\t * @param isInner\n\t */\n\tpublic static function processHTML(target:js.html.Element, html:String, isInner:Bool) {\n\t\tif (isInner) {\n\t\t\ttarget.innerHTML = html;\n\t\t} else {\n\t\t\ttarget.outerHTML = html;\n\t\t}\n\t}\n\n\t/**\n\t * [Description]\n\t * @param html\n\t * @param isInner = true\n\t */\n\tpublic static function htmlToElement(html:String, isInner = true) {\n\t\tvar template = document.createDivElement();\n\t\thtml = untyped html.trim(); // Never return a text node of whitespace as the result\n\t\tHtml.processHTML(template, html, isInner);\n\t\t// template.innerHTML = html;\n\t\treturn template.firstChild;\n\t}\n}\n","package utils;\n\nclass Time {\n\tvar starttime = .0;\n\tvar endtime = .0;\n\n\tpublic function new() {\n\t\tstarttime = Time.get();\n\t}\n\n\tpublic function start() {\n\t\tstarttime = Time.get();\n\t}\n\n\tpublic function end() {\n\t\tendtime = Time.get();\n\t}\n\n\t/**\n\t * total time in ms\n\t */\n\tpublic function total() {\n\t\tendtime = Time.get();\n\t\treturn ((endtime - starttime) + 'ms');\n\t}\n\n\t/**\n\t * var starttime = Time.get();\n\t */\n\tpublic static function get() {\n\t\treturn Date.now().getTime();\n\t}\n}\n"],
"names":[],
"mappings":"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"
}